<div class="goal-tracking-container">
  <!-- ğŸ”¹ Title Section -->
  <div class="goal-tracking-title">
    <h1>ğŸ¯ Achieve Your Goals</h1>
    <p>Monitor your progress, track weekly stats, and stay motivated!</p>
  </div>

  <!-- ğŸ”¹ Goals Section -->
  <div class="goals-grid" *ngIf="goals() && goals().length > 0; else noGoals">
    <div
      class="goal-card"
      *ngFor="let goal of goals()"
      [class.completed]="calculateProgress(goal) === 100"
    >
      <!-- Edit Mode -->
      <div *ngIf="goal.editing; else viewGoal">
        <div class="goal-card-edit">
          <input type="text" [(ngModel)]="goal.name" placeholder="Goal Name" />
          <select [(ngModel)]="goal.type">
            <option value="Weight">Weight</option>
            <option value="Calories">Calories</option>
            <option value="Distance">Distance</option>
            <option value="Duration">Duration</option>
          </select>

          <input type="number" [(ngModel)]="goal.initialValue" placeholder="Initial Value" />
          <input type="number" [(ngModel)]="goal.currentValue" placeholder="Current Value" />
          <input type="number" [(ngModel)]="goal.targetValue" placeholder="Target Value" />
          <input type="text" [(ngModel)]="goal.unit" placeholder="Unit (e.g. kg, km)" />

          <div class="edit-actions">
            <button (click)="updateGoal(goal._id!, goal)">ğŸ’¾ Save</button>
            <button (click)="goal.editing = false">âœ– Cancel</button>
          </div>
        </div>
      </div>

      <!-- View Mode -->
      <ng-template #viewGoal>
        <div class="goal-card-header">
          <h3>{{ goal.name }}</h3>
          <p class="goal-type">{{ goal.type }}</p>
          <div *ngIf="calculateProgress(goal) === 100" class="goal-completed-badge">ğŸ†</div>
        </div>

        <div class="goal-card-body">
          <div class="goal-details">
            <div class="goal-detail">
              <span class="detail-label">Current</span>
              <span class="detail-value">{{ goal.currentValue }} {{ goal.unit }}</span>
            </div>
            <div class="goal-detail">
              <span class="detail-label">Target</span>
              <span class="detail-value">{{ goal.targetValue }} {{ goal.unit }}</span>
            </div>
          </div>

          <div class="progress-bar-container">
            <div class="progress-bar" [style.width.%]="calculateProgress(goal)"></div>
          </div>

          <p class="progress-text">{{ calculateProgress(goal) | number : '1.0-0' }}% Complete</p>
        </div>

        <div class="goal-card-footer">
          <button (click)="goal.editing = true">âœï¸ Edit</button>
          <button (click)="removeGoal(goal._id!)">ğŸ—‘ Remove</button>
        </div>
      </ng-template>
    </div>
  </div>

  <ng-template #noGoals>
    <p class="empty-message">You have no goals yet. Add one to get started!</p>
  </ng-template>

  <!-- ğŸ”¹ Add Goal Section -->
<div class="add-goal-form">
  <form (ngSubmit)="addGoalFromForm()" class="goal-form">
    <h2>Add new goal</h2>

    <div class="form-grid">
      <div class="form-group">
        <label>Goal Name</label>
        <input type="text" [(ngModel)]="goalForm.name" name="name" required />
      </div>

      <div class="form-group">
        <label>Type</label>
        <select [(ngModel)]="goalForm.type" name="type">
          <option value="Weight">Weight</option>
          <option value="Calories">Calories</option>
          <option value="Distance">Distance</option>
          <option value="Duration">Duration</option>
        </select>
      </div>

      <div class="form-group">
        <label>Initial Value</label>
        <input type="number" [(ngModel)]="goalForm.initialValue" name="initialValue" required />
      </div>

      <div class="form-group">
        <label>Current Value</label>
        <input type="number" [(ngModel)]="goalForm.currentValue" name="currentValue" required />
      </div>

      <div class="form-group">
        <label>Target Value</label>
        <input type="number" [(ngModel)]="goalForm.targetValue" name="targetValue" required />
      </div>

      <div class="form-group">
        <label>Unit</label>
        <input type="text" [(ngModel)]="goalForm.unit" name="unit" />
      </div>
    </div>

    <button type="submit">Add Goal</button>
  </form>
</div>


  <!-- ğŸ”¹ Weekly Weight Tracking -->
  <div class="weekly-weight-section">
    <h2>ğŸ“… Weekly Weight Tracking</h2>

    <div
      class="weight-table-container"
      *ngIf="weeklyWeights() && weeklyWeights().length > 0; else noWeights"
    >
      <table class="weight-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Weight (kg)</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let entry of weeklyWeights()">
            <td *ngIf="!entry.editing">{{ entry.date | date : 'mediumDate' }}</td>
            <td *ngIf="entry.editing"><input type="date" [(ngModel)]="entry.date" /></td>

            <td *ngIf="!entry.editing">{{ entry.weight }}</td>
            <td *ngIf="entry.editing"><input type="number" [(ngModel)]="entry.weight" /></td>

            <td>
              <button *ngIf="!entry.editing" (click)="entry.editing = true">âœï¸ Edit</button>
              <button *ngIf="entry.editing" (click)="updateWeightEntry(entry._id!, entry)">
                ğŸ’¾ Save
              </button>
              <button *ngIf="entry.editing" (click)="entry.editing = false">âœ– Cancel</button>
              <button (click)="removeWeightEntry(entry._id!)">ğŸ—‘ Remove</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <ng-template #noWeights>
      <p class="empty-message">No weight entries yet.</p>
    </ng-template>

    <div class="add-weight-entry-form">
      <h3>Add New Weight Entry</h3>
      <input #dateInput type="date" />
      <input #weightInput type="number" placeholder="Weight (kg)" />
      <button
        (click)="
          addWeightEntry({ date: dateInput.value, weight: +weightInput.value });
          dateInput.value = '';
          weightInput.value = ''
        "
      >
        â• Add Entry
      </button>
    </div>
  </div>
</div>
